<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout-admin :: layout(~{::main}, 'Qu·∫£n l√Ω giao d·ªãch - Bakery', ~{::extraHead}, ~{::extraScripts})}">
<head>
    <title>Qu·∫£n l√Ω giao d·ªãch - Bakery</title>
    <th:block th:fragment="extraHead">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <style>
            /* Admin Base Styles */
            .admin-header {
                background: #2c3e50;
                color: white;
                padding: 15px 0;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 1000;
            }

            .admin-container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .admin-layout {
                display: flex;
                margin-top: 70px;
                min-height: calc(100vh - 70px);
            }

            .admin-sidebar {
                width: 250px;
                background: #34495e;
                color: white;
                position: fixed;
                height: calc(100vh - 70px);
                overflow-y: auto;
            }

            .admin-main {
                flex: 1;
                margin-left: 250px;
                padding: 30px;
                background: #ecf0f1;
            }

            /* Transaction Page Styles */
            .page-header {
                margin-bottom: 30px;
            }

            .page-header h1 {
                font-size: 28px;
                color: #2c3e50;
                margin-bottom: 10px;
            }

            .breadcrumb {
                color: #7f8c8d;
                font-size: 14px;
            }

            /* Statistics Cards */
            .stats-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .stat-card {
                background: white;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .stat-info h3 {
                font-size: 14px;
                color: #7f8c8d;
                margin-bottom: 8px;
            }

            .stat-info .number {
                font-size: 28px;
                font-weight: bold;
                color: #2c3e50;
            }

            .stat-icon {
                font-size: 40px;
            }

            .stat-card.total { border-left: 4px solid #3498db; }
            .stat-card.success { border-left: 4px solid #27ae60; }
            .stat-card.failed { border-left: 4px solid #e74c3c; }
            .stat-card.pending { border-left: 4px solid #f39c12; }

            /* Filter Section */
            .filter-section {
                background: white;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 20px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .filter-title {
                font-size: 18px;
                font-weight: bold;
                color: #2c3e50;
                margin-bottom: 15px;
            }

            .filter-form {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr auto;
                gap: 15px;
                align-items: end;
            }

            .form-group {
                display: flex;
                flex-direction: column;
            }

            .form-group label {
                font-size: 14px;
                color: #2c3e50;
                margin-bottom: 5px;
                font-weight: 500;
            }

            .form-group input,
            .form-group select {
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 14px;
            }

            .filter-buttons {
                display: flex;
                gap: 10px;
            }

            .btn {
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.3s;
            }

            .btn-primary {
                background: #3498db;
                color: white;
            }

            .btn-primary:hover {
                background: #2980b9;
            }

            .btn-secondary {
                background: #95a5a6;
                color: white;
            }

            .btn-secondary:hover {
                background: #7f8c8d;
            }

            /* Table Styles */
            .table-container {
                background: white;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .table-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }

            .table-header h2 {
                font-size: 18px;
                color: #2c3e50;
            }

            .table-info {
                font-size: 14px;
                color: #7f8c8d;
            }

            table {
                width: 100%;
                border-collapse: collapse;
            }

            thead {
                background: #ecf0f1;
            }

            th {
                padding: 12px;
                text-align: left;
                font-weight: 600;
                color: #2c3e50;
                font-size: 14px;
            }

            td {
                padding: 12px;
                border-bottom: 1px solid #ecf0f1;
                font-size: 14px;
            }

            tbody tr:hover {
                background: #f8f9fa;
            }

            /* Status Badges */
            .status-badge {
                display: inline-block;
                padding: 5px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
            }

            .status-success {
                background: #d4edda;
                color: #155724;
            }

            .status-failed {
                background: #f8d7da;
                color: #721c24;
            }

            .status-pending {
                background: #fff3cd;
                color: #856404;
            }

            /* Method Badges */
            .method-badge {
                display: inline-block;
                padding: 5px 12px;
                border-radius: 5px;
                font-size: 12px;
                font-weight: 600;
            }

            .method-vnpay {
                background: #e3f2fd;
                color: #1565c0;
            }

            .method-cod {
                background: #f3e5f5;
                color: #6a1b9a;
            }

            /* Pagination */
            .pagination {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
                margin-top: 20px;
                padding-top: 20px;
                border-top: 1px solid #ecf0f1;
            }

            .pagination a,
            .pagination span {
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 5px;
                text-decoration: none;
                color: #2c3e50;
                font-size: 14px;
            }

            .pagination a:hover {
                background: #3498db;
                color: white;
                border-color: #3498db;
            }

            .pagination .current {
                background: #3498db;
                color: white;
                border-color: #3498db;
            }

            .pagination .disabled {
                opacity: 0.5;
                cursor: not-allowed;
                pointer-events: none;
            }

            /* Empty State */
            .empty-state {
                text-align: center;
                padding: 60px 20px;
                color: #7f8c8d;
            }

            .empty-state .icon {
                font-size: 64px;
                margin-bottom: 20px;
            }

            .empty-state h3 {
                font-size: 20px;
                margin-bottom: 10px;
            }

            .empty-state p {
                font-size: 14px;
            }

            /* Responsive */
            @media (max-width: 1024px) {
                .filter-form {
                    grid-template-columns: 1fr 1fr;
                }

                .filter-buttons {
                    grid-column: 1 / -1;
                }
            }

            @media (max-width: 768px) {
                .filter-form {
                    grid-template-columns: 1fr;
                }

                .stats-container {
                    grid-template-columns: 1fr;
                }

                .table-container {
                    overflow-x: auto;
                }

                table {
                    min-width: 800px;
                }
            }
        </style>
    </th:block>
</head>

<body>
<main th:fragment="main">
    <!-- Page Header -->
    <div class="page-header">
        <h1>üí≥ Qu·∫£n l√Ω giao d·ªãch</h1>
        <div class="breadcrumb">Dashboard / Qu·∫£n l√Ω giao d·ªãch</div>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-container">
        <div class="stat-card total">
            <div class="stat-info">
                <h3>T·ªïng giao d·ªãch</h3>
                <div class="number" th:text="${totalTransactions}">0</div>
            </div>
            <div class="stat-icon">üí≥</div>
        </div>

        <div class="stat-card success">
            <div class="stat-info">
                <h3>Th√†nh c√¥ng</h3>
                <div class="number" th:text="${successCount}">0</div>
            </div>
            <div class="stat-icon">‚úÖ</div>
        </div>

        <div class="stat-card failed">
            <div class="stat-info">
                <h3>Th·∫•t b·∫°i</h3>
                <div class="number" th:text="${failedCount}">0</div>
            </div>
            <div class="stat-icon">‚ùå</div>
        </div>

        <div class="stat-card pending">
            <div class="stat-info">
                <h3>ƒêang ch·ªù</h3>
                <div class="number" th:text="${pendingCount}">0</div>
            </div>
            <div class="stat-icon">‚è≥</div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <div class="filter-title">üîç T√¨m ki·∫øm v√† l·ªçc</div>
        <form th:action="@{/admin/transactions}" method="get" class="filter-form">
            <div class="form-group">
                <label for="vnpayTxnRef">VNPay TxnRef</label>
                <input type="text" id="vnpayTxnRef" name="vnpayTxnRef" 
                       th:value="${vnpayTxnRef}"
                       placeholder="Nh·∫≠p VNPay TxnRef...">
            </div>

            <div class="form-group">
                <label for="status">Tr·∫°ng th√°i</label>
                <select id="status" name="status">
                    <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    <option value="SUCCESS" th:selected="${status == 'SUCCESS'}">Th√†nh c√¥ng</option>
                    <option value="FAILED" th:selected="${status == 'FAILED'}">Th·∫•t b·∫°i</option>
                    <option value="PENDING" th:selected="${status == 'PENDING'}">ƒêang ch·ªù</option>
                </select>
            </div>

            <div class="form-group">
                <label for="size">S·ªë b·∫£n ghi/trang</label>
                <select id="size" name="size">
                    <option value="10" th:selected="${size == 10}">10</option>
                    <option value="20" th:selected="${size == 20}">20</option>
                    <option value="50" th:selected="${size == 50}">50</option>
                    <option value="100" th:selected="${size == 100}">100</option>
                </select>
            </div>

            <div class="filter-buttons">
                <button type="submit" class="btn btn-primary">T√¨m ki·∫øm</button>
                <a th:href="@{/admin/transactions}" class="btn btn-secondary">X√≥a b·ªô l·ªçc</a>
            </div>
        </form>
    </div>

    <!-- Transaction Table -->
    <div class="table-container">
        <div class="table-header">
            <h2>üìã Danh s√°ch giao d·ªãch</h2>
            <div class="table-info">
                Hi·ªÉn th·ªã <strong th:text="${transactions.size()}">0</strong> / 
                <strong th:text="${totalElements}">0</strong> giao d·ªãch
            </div>
        </div>

        <!-- Table with data -->
        <div th:if="${transactions != null && !transactions.isEmpty()}">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>M√£ ƒë∆°n h√†ng</th>
                        <th>Ph∆∞∆°ng th·ª©c</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>VNPay TxnRef</th>
                        <th>M√£ giao d·ªãch VNPay</th>
                        <th>M√£ ng√¢n h√†ng</th>
                        <th>Ng√†y giao d·ªãch</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="transaction : ${transactions}">
                        <td th:text="${transaction.paymentId}">#1</td>
                        <td>
                            <strong th:text="'#' + ${transaction.order.orderId}">ORD001</strong>
                        </td>
                        <td>
                            <span class="method-badge" 
                                  th:classappend="${transaction.method == 'VNPAY'} ? 'method-vnpay' : 'method-cod'"
                                  th:text="${transaction.method}">VNPAY</span>
                        </td>
                        <td>
                            <span class="status-badge"
                                  th:classappend="${transaction.status == 'SUCCESS'} ? 'status-success' : 
                                                 (${transaction.status == 'FAILED'} ? 'status-failed' : 'status-pending')"
                                  th:text="${transaction.status == 'SUCCESS'} ? 'Th√†nh c√¥ng' : 
                                           (${transaction.status == 'FAILED'} ? 'Th·∫•t b·∫°i' : 'ƒêang ch·ªù')">
                                Th√†nh c√¥ng
                            </span>
                        </td>
                        <td>
                            <code th:text="${transaction.vnpayTxnRef ?: '-'}">TXN123456</code>
                        </td>
                        <td>
                            <code th:text="${transaction.vnpayTransactionNo ?: '-'}">14532678</code>
                        </td>
                        <td th:text="${transaction.vnpayBankCode ?: '-'}">NCB</td>
                        <td th:text="${transaction.transactionDate != null ? #temporals.format(transaction.transactionDate, 'dd/MM/yyyy HH:mm') : '-'}">
                            01/01/2024 10:30
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Pagination -->
            <div class="pagination" th:if="${totalPages > 1}">
                <!-- Previous Button -->
                <a th:href="@{/admin/transactions(page=${currentPage - 1}, size=${size}, vnpayTxnRef=${vnpayTxnRef}, status=${status})}"
                   th:classappend="${currentPage == 0} ? 'disabled' : ''">
                    ‚Üê Tr∆∞·ªõc
                </a>

                <!-- Page Numbers -->
                <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                    <a th:if="${i == currentPage}"
                       class="current"
                       th:text="${i + 1}">1</a>
                    
                    <a th:if="${i != currentPage}"
                       th:href="@{/admin/transactions(page=${i}, size=${size}, vnpayTxnRef=${vnpayTxnRef}, status=${status})}"
                       th:text="${i + 1}">1</a>
                </th:block>

                <!-- Next Button -->
                <a th:href="@{/admin/transactions(page=${currentPage + 1}, size=${size}, vnpayTxnRef=${vnpayTxnRef}, status=${status})}"
                   th:classappend="${currentPage >= totalPages - 1} ? 'disabled' : ''">
                    Ti·∫øp ‚Üí
                </a>
            </div>
        </div>

        <!-- Empty State -->
        <div th:if="${transactions == null || transactions.isEmpty()}" class="empty-state">
            <div class="icon">üì≠</div>
            <h3>Kh√¥ng t√¨m th·∫•y giao d·ªãch</h3>
            <p>Kh√¥ng c√≥ giao d·ªãch n√†o ph√π h·ª£p v·ªõi ti√™u ch√≠ t√¨m ki·∫øm c·ªßa b·∫°n.</p>
        </div>
    </div>
</main>

<th:block th:fragment="extraScripts">
    <script>
        // Auto-focus on search input
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('vnpayTxnRef');
            if (searchInput && searchInput.value === '') {
                searchInput.focus();
            }
        });

        // Highlight current page in pagination
        document.querySelectorAll('.pagination a.current').forEach(function(el) {
            el.style.pointerEvents = 'none';
        });
    </script>
</th:block>
</body>
</html>

