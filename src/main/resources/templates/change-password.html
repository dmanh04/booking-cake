<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(~{::main}, 'Thay ƒë·ªïi m·∫≠t kh·∫©u - Bakery', ~{::extraHead}, ~{::extraScripts})}">
<head>
    <title>Thay ƒë·ªïi m·∫≠t kh·∫©u - Bakery</title>
    <th:block th:fragment="extraHead">
        <style>
            .password-container {
                max-width: 500px;
                margin: 2rem auto;
                padding: 2rem;
            }

            .form-card {
                background: white;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                padding: 2rem;
            }

            .form-header {
                text-align: center;
                margin-bottom: 2rem;
            }

            .form-header h1 {
                font-size: 1.75rem;
                font-weight: 600;
                color: #1a1a1a;
                margin-bottom: 0.5rem;
            }

            .form-header p {
                color: #666;
                font-size: 0.95rem;
            }

            .form-group {
                margin-bottom: 1.5rem;
            }

            .form-label {
                display: block;
                font-weight: 500;
                color: #333;
                margin-bottom: 0.5rem;
                font-size: 0.95rem;
            }

            .form-label .required {
                color: #dc3545;
                margin-left: 2px;
            }

            .form-control {
                width: 100%;
                padding: 0.75rem 1rem;
                border: 1px solid #ddd;
                border-radius: 8px;
                font-size: 1rem;
                transition: all 0.3s ease;
            }

            .form-control:focus {
                outline: none;
                border-color: #ff6b35;
                box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
            }

            .form-control.is-invalid {
                border-color: #dc3545;
            }

            .invalid-feedback {
                display: block;
                color: #dc3545;
                font-size: 0.875rem;
                margin-top: 0.5rem;
            }

            .alert {
                padding: 1rem;
                border-radius: 8px;
                margin-bottom: 1.5rem;
                font-size: 0.95rem;
            }

            .alert-danger {
                background-color: #fee;
                color: #c33;
                border: 1px solid #fcc;
            }

            .alert-success {
                background-color: #efe;
                color: #3c3;
                border: 1px solid #cfc;
            }

            .btn-primary {
                width: 100%;
                padding: 0.875rem;
                background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
            }

            .btn-primary:active {
                transform: translateY(0);
            }

            .password-requirements {
                background: #f8f9fa;
                border-radius: 8px;
                padding: 1rem;
                margin-top: 1rem;
                font-size: 0.875rem;
            }

            .password-requirements h4 {
                font-size: 0.9rem;
                font-weight: 600;
                margin-bottom: 0.5rem;
                color: #333;
            }

            .password-requirements ul {
                margin: 0;
                padding-left: 1.25rem;
                color: #666;
            }

            .password-requirements li {
                margin-bottom: 0.25rem;
            }

            .back-link {
                text-align: center;
                margin-top: 1.5rem;
            }

            .back-link a {
                color: #ff6b35;
                text-decoration: none;
                font-weight: 500;
                transition: color 0.3s ease;
            }

            .back-link a:hover {
                color: #ff8c42;
                text-decoration: underline;
            }
        </style>
    </th:block>
</head>
<body>
<main>
    <div class="password-container">
        <div class="form-card">
            <div class="form-header">
                <h1>üîí Thay ƒë·ªïi m·∫≠t kh·∫©u</h1>
                <p>B·∫£o m·∫≠t t√†i kho·∫£n c·ªßa b·∫°n b·∫±ng m·∫≠t kh·∫©u m·∫°nh</p>
            </div>

            <!-- Success message -->
            <div th:if="${successMessage}" class="alert alert-success" role="alert" style="margin-bottom:15px;">
                <span th:text="${successMessage}"></span>
            </div>

            <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
                <strong>‚ùå L·ªói:</strong> <span th:text="${errorMessage}"></span>
            </div>

            <form th:action="@{/change-password}"
                  th:object="${changePasswordRequest}"
                  method="post"
                  id="changePasswordForm">

                <div class="form-group">
                    <label for="currentPassword" class="form-label">
                        M·∫≠t kh·∫©u hi·ªán t·∫°i <span class="required">*</span>
                    </label>
                    <input type="password"
                           class="form-control"
                           th:classappend="${#fields.hasErrors('currentPassword')} ? 'is-invalid' : ''"
                           id="currentPassword"
                           th:field="*{currentPassword}"
                           placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i"
                           required>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('currentPassword')}"
                         th:errors="*{currentPassword}"></div>
                </div>

                <div class="form-group">
                    <label for="newPassword" class="form-label">
                        M·∫≠t kh·∫©u m·ªõi <span class="required">*</span>
                    </label>
                    <input type="password"
                           class="form-control"
                           th:classappend="${#fields.hasErrors('newPassword')} ? 'is-invalid' : ''"
                           id="newPassword"
                           th:field="*{newPassword}"
                           placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi"
                           minlength="6"
                           required>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('newPassword')}"
                         th:errors="*{newPassword}"></div>
                </div>

                <div class="form-group">
                    <label for="confirmPassword" class="form-label">
                        X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi <span class="required">*</span>
                    </label>
                    <input type="password"
                           class="form-control"
                           th:classappend="${#fields.hasErrors('confirmPassword')} ? 'is-invalid' : ''"
                           id="confirmPassword"
                           th:field="*{confirmPassword}"
                           placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi"
                           required>
                    <div class="invalid-feedback" th:if="${#fields.hasErrors('confirmPassword')}"
                         th:errors="*{confirmPassword}"></div>
                </div>

                <div class="password-requirements">
                    <h4>üìã Y√™u c·∫ßu m·∫≠t kh·∫©u:</h4>
                    <ul>
                        <li>T·ªëi thi·ªÉu 6 k√Ω t·ª±</li>
                        <li>N√™n bao g·ªìm ch·ªØ hoa, ch·ªØ th∆∞·ªùng v√† s·ªë</li>
                        <li>Kh√¥ng ƒë∆∞·ª£c tr√πng v·ªõi m·∫≠t kh·∫©u hi·ªán t·∫°i</li>
                    </ul>
                </div>

                <button type="submit" class="btn-primary">
                    ƒê·ªïi m·∫≠t kh·∫©u
                </button>
            </form>

            <div class="back-link">
                <a th:href="@{/home}">‚Üê Quay l·∫°i trang ch·ªß</a>
            </div>
        </div>
    </div>
</main>

<th:block th:fragment="extraScripts">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('changePasswordForm');
            const newPassword = document.getElementById('newPassword');
            const confirmPassword = document.getElementById('confirmPassword');

            // Real-time password match validation
            confirmPassword.addEventListener('input', function() {
                if (newPassword.value !== confirmPassword.value) {
                    confirmPassword.setCustomValidity('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp');
                } else {
                    confirmPassword.setCustomValidity('');
                }
            });

            newPassword.addEventListener('input', function() {
                if (confirmPassword.value && newPassword.value !== confirmPassword.value) {
                    confirmPassword.setCustomValidity('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp');
                } else {
                    confirmPassword.setCustomValidity('');
                }
            });

            // Form submission validation
            form.addEventListener('submit', function(e) {
                if (newPassword.value !== confirmPassword.value) {
                    e.preventDefault();
                    alert('M·∫≠t kh·∫©u m·ªõi v√† x√°c nh·∫≠n m·∫≠t kh·∫©u kh√¥ng kh·ªõp!');
                    return false;
                }

                if (newPassword.value.length < 6) {
                    e.preventDefault();
                    alert('M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
                    return false;
                }
            });
        });
    </script>
</th:block>
</body>
</html>
